{"version":3,"sources":["../../src/middleware/validate_payload.js"],"names":["run","http","post","_post","length","think","config","res","statusCode","end","prevent","maxFilesSize","name","middleware","base"],"mappings":"AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKE;;;;mBAIAA,G,kBAAK;AACH,QAAIC,OAAO,KAAKA,IAAhB;AACA,QAAIC,OAAOD,KAAKE,KAAhB;AACA,QAAIC,SAAS,oBAAYF,IAAZ,EAAkBE,MAA/B;AACA,QAAIA,SAASC,MAAMC,MAAN,CAAa,iBAAb,CAAb,EAA8C;AAC5CL,WAAKM,GAAL,CAASC,UAAT,GAAsB,GAAtB;AACAP,WAAKQ,GAAL;AACA,aAAOJ,MAAMK,OAAN,EAAP;AACD;AACD,QAAIC,eAAeN,MAAMC,MAAN,CAAa,sBAAb,CAAnB;AACA,SAAI,IAAIM,IAAR,IAAgBV,IAAhB,EAAqB;AACnB,UAAIA,KAAKU,IAAL,KAAcV,KAAKU,IAAL,EAAWR,MAAX,GAAoBO,YAAtC,EAAoD;AAClDV,aAAKM,GAAL,CAASC,UAAT,GAAsB,GAAtB;AACAP,aAAKQ,GAAL;AACA,eAAOJ,MAAMK,OAAN,EAAP;AACD;AACF;AACF,G;;;EAtB0BL,MAAMQ,UAAN,CAAiBC,I","file":"validate_payload.js","sourcesContent":["'use strict';\n\n/**\n * validate post data\n * @type {}\n */\nexport default class extends think.middleware.base {\n  /**\n   * run\n   * @return {} []\n   */\n  run(){\n    let http = this.http;\n    let post = http._post;\n    let length = Object.keys(post).length;\n    if (length > think.config('post.max_fields')) {\n      http.res.statusCode = 400;\n      http.end();\n      return think.prevent();\n    }\n    let maxFilesSize = think.config('post.max_fields_size');\n    for(let name in post){\n      if (post[name] && post[name].length > maxFilesSize) {\n        http.res.statusCode = 400;\n        http.end();\n        return think.prevent();\n      }\n    }\n  }\n}"]}